### CVE 2016-9827 https://blogs.gentoo.org/ago/2016/12/01/libming-listswf-heap-based-buffer-overflow-in-_iprintf-outputtxt-c/

cd ~/projects
git clone https://github.com/libming/libming.git libming-CVE-2016-9827
cd libming-CVE-2016-9827
git checkout cc6a386

### prerequisites
apt update 
apt -y install pkg-config bison flex libfreetype6 libfreetype6-dev

### get info
mkdir -p obj-fgo/temp
export FGO=~/fuzzer/fgo-new
export SUBJECT=$PWD
export TMP_DIR=$PWD/obj-fgo/temp
export CC=$FGO/afl-clang-fast
export CXX=$FGO/afl-clang-fast++
export LDFLAGS=-lpthread
export ADDITIONAL="-targets=$TMP_DIR/BBtargets.txt -outdir=$TMP_DIR -flto -fuse-ld=gold -Wl,-plugin-opt=save-temps"
#### targets
echo $'outputtxt.c:1873\noutputtxt.c:144' > $TMP_DIR/BBtargets.txt
./autogen.sh
cd obj-fgo
export CFLAGS="$ADDITIONAL" 
export CXXFLAGS="$ADDITIONAL" 
../configure --disable-shared --prefix=`pwd` --disable-freetype
make clean
make

### handle 
cat $TMP_DIR/BBnames.txt | rev | cut -d: -f2- | rev | sort | uniq > $TMP_DIR/BBnames2.txt && mv $TMP_DIR/BBnames2.txt $TMP_DIR/BBnames.txt
cat $TMP_DIR/BBcalls.txt | sort | uniq > $TMP_DIR/BBcalls2.txt && mv $TMP_DIR/BBcalls2.txt $TMP_DIR/BBcalls.txt

### get distance
cd util ### program directory
$FGO/distance/distance_generator.py $SUBJECT/obj-fgo/util $TMP_DIR listswf ### program

### instrument
cd $SUBJECT
mkdir obj-dist
cd obj-dist
export CFLAGS="-distance=$TMP_DIR/distance.cfg.txt"
export CXXFLAGS="-distance=$TMP_DIR/distance.cfg.txt"
../configure --disable-shared --prefix=`pwd` --disable-freetype
make clean
make

### fuzz
mkdir in
echo "" > in/in ### seed
export AFL_I_DONT_CARE_ABOUT_MISSING_CRASHES="true"
$FGO/afl-fuzz -m none -z exp -c 120m -i in -o out -t 5000+ -p 30m -P 20 ./util/listswf @@ ### program
